# H_Q_Table --------------------------------------------------------------------

#' H-Q-Relationship Given by Manufacturer
#' 
#' @param DN DN in mm, must be one of 150, 300
#' 
#' @return data frame with columns \emph{H_m, Q_L_s, Q_m3_s, Q_L_h, Q_m3_h}
#' 
H_Q_Table <- function(DN)
{
  if (DN == 150) {
    
    hq <- as.data.frame(H_Q_Matrix_DN_150())
    
  } else if (DN == 300) {
    
    hq <- as.data.frame(H_Q_Matrix_DN_300())
    
  } else {
    
    stopWithNoSuchDN()
  }
  
  names(hq) <- c("H_m", "Q_L_h")
  convertQUnits(hq)
}

# H_Q_Matrix_DN_150 ------------------------------------------------------------
H_Q_Matrix_DN_150 <- function() {
  matrix(ncol = 2, byrow = TRUE, c(
    0.006, 47.54, 
    0.012, 183.68, 
    0.018, 404.99, 
    0.025, 768.5, 
    0.032, 1243.66, 
    0.038, 1738.75, 
    0.044, 2314.16, 
    0.050, 2969.28, 
    0.057, 3833.68, 
    0.063, 4659.87, 
    0.069, 5564.37,
    0.075, 6546.81, 
    0.082, 7791.07, 
    0.088, 8941.31, 
    0.094, 10168.56, 
    0.100, 11472.56, 
    0.107, 13090.57, 
    0.113, 14560.06, 
    0.119, 16105.59, 
    0.125, 17726.98, 
    0.132, 19714.21, 
    0.138, 21499.3, 
    0.144, 23359.69,
    0.150, 25295.2, 
    0.157, 27648.05, 
    0.163, 29745.82, 
    0.169, 31918.26, 
    0.176, 34546.96, 
    0.184, 37675.15, 
    0.191, 40520.54, 
    0.198, 43466.76, 
    0.205, 46513.63, 
    0.212, 49660.96, 
    0.219, 52908.59, 
    0.227, 56778.56
  ))
}

# H_Q_Matrix_DN_300 ------------------------------------------------------------
H_Q_Matrix_DN_300 <- function() {
  matrix(ncol = 2, byrow = TRUE, c(
    0.013, 329.11, 
    0.026, 1271.6, 
    0.039, 2803.69, 
    0.052, 4913.15, 
    0.065, 7591.62, 
    0.078, 10832.73, 
    0.091, 14631.35, 
    0.104, 18983.16, 
    0.117, 23884.49, 
    0.130, 29332.1, 
    0.143, 35323.11, 
    0.156, 41854.93, 
    0.169, 48925.21, 
    0.182, 56531.8, 
    0.195, 64672.72, 
    0.208, 73346.11, 
    0.221, 82550.28, 
    0.234, 92283.6, 
    0.247, 102544.57, 
    0.260, 113331.76, 
    0.273, 124643.82, 
    0.286, 136479.48, 
    0.299, 148837.52, 
    0.312, 161716.77, 
    0.325, 175116.13, 
    0.338, 189034.54, 
    0.351, 203470.98, 
    0.364, 218424.48, 
    0.377, 233894.09, 
    0.390, 249878.9, 
    0.403, 266378.06, 
    0.416, 283390.7, 
    0.429, 300916.03, 
    0.442, 318953.25, 
    0.457, 339846.98
  ))
}

# convertQUnits ----------------------------------------------------------------

#' Convert Q in L/h to L/s, m3/s and m3/h
#' 
#' @param hq data frame containing a column \emph{Q_L_h} containing flows in L/h
#' 
#' @return data frame with columns \emph{H_m, Q_L_s, Q_m3_s, Q_L_h, Q_m3_h}
#' 
convertQUnits <- function(hq)
{
  hq$Q_L_s  <- round(hq$Q_L_h / 3600, 3)
  hq$Q_m3_s <- round(hq$Q_L_h / 3600000, 6)
  hq$Q_m3_h <- round(hq$Q_L_h / 1000, 3)
  
  hq[, c("H_m", "Q_L_s", "Q_m3_s", "Q_L_h", "Q_m3_h")]
}

